
-- Create tables

CREATE TABLE IF NOT EXISTS personnel (
    unique_code INT NOT NULL AUTO_INCREMENT,
    dob DATE NOT NULL,
    fullname VARCHAR(50) COLLATE utf8mb4_general_ci NOT NULL,
    phone CHAR(12) COLLATE utf8mb4_general_ci NOT NULL,
    gender CHAR(1) COLLATE utf8mb4_general_ci NOT NULL,
    address VARCHAR(50) COLLATE utf8mb4_general_ci NOT NULL,
    PRIMARY KEY (unique_code)
);

CREATE TABLE IF NOT EXISTS staff (
    staff_code INT NOT NULL,
    PRIMARY KEY (staff_code),
    CONSTRAINT staff_fk_constraint FOREIGN KEY (staff_code) REFERENCES personnel (unique_code) ON UPDATE NO ACTION ON DELETE NO ACTION
);


CREATE TABLE IF NOT EXISTS admit (
    patient_number INT NOT NULL,
    staff_code INT NOT NULL,
    admission_date DATE NOT NULL,
    `from` VARCHAR(50) COLLATE utf8mb4_general_ci,
    PRIMARY KEY (patient_number),
    CONSTRAINT admit_fk_constraint FOREIGN KEY (staff_code) REFERENCES staff (staff_code) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS building (
    building_id INT NOT NULL AUTO_INCREMENT,
    PRIMARY KEY (building_id)
);

CREATE TABLE IF NOT EXISTS doctor (
    doctor_code INT NOT NULL,
    PRIMARY KEY (doctor_code),
    CONSTRAINT doctor_fk_constraint FOREIGN KEY (doctor_code) REFERENCES personnel (unique_code) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS floor (
    building_id INT NOT NULL,
    floor_number INT NOT NULL,
    PRIMARY KEY (building_id, floor_number),
    CONSTRAINT floor_fk_constraint FOREIGN KEY (building_id) REFERENCES building (building_id) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS patient (
    patient_number INT NOT NULL AUTO_INCREMENT,
    identity_number VARCHAR(12) COLLATE utf8mb4_general_ci,
    fullname VARCHAR(50) COLLATE utf8mb4_general_ci NOT NULL,
    phone VARCHAR(11) COLLATE utf8mb4_general_ci,
    gender CHAR(1) COLLATE utf8mb4_general_ci NOT NULL,
    address VARCHAR(50) COLLATE utf8mb4_general_ci,
    discharge_date DATE,
    PRIMARY KEY (patient_number),
    UNIQUE (identity_number)
);

CREATE TABLE IF NOT EXISTS patient_comorbidity (
    patient_number INT NOT NULL,
    comorbidity VARCHAR(255) COLLATE utf8mb4_general_ci NOT NULL,
    PRIMARY KEY (patient_number, comorbidity),
    CONSTRAINT patient_comorbidity_foreignkey_constraint FOREIGN KEY (patient_number) REFERENCES patient (patient_number) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS room (
    building_id INT NOT NULL,
    floor_number INT NOT NULL,
    room_number INT NOT NULL,
    capacity INT NOT NULL,
    PRIMARY KEY (building_id, floor_number, room_number),
    CONSTRAINT room_fk_constraint FOREIGN KEY (building_id, floor_number) REFERENCES floor (building_id, floor_number) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS location_history (
    patient_number INT NOT NULL,
    date_time TIMESTAMP NOT NULL,
    building_id INT NOT NULL,
    floor_number INT NOT NULL,
    room_number INT NOT NULL,
    PRIMARY KEY (patient_number, date_time),
    CONSTRAINT location_patient_fk_constraint FOREIGN KEY (patient_number) REFERENCES patient (patient_number) ON UPDATE NO ACTION ON DELETE NO ACTION,
    CONSTRAINT location_room_fk_constraint FOREIGN KEY (building_id, floor_number, room_number) REFERENCES room (building_id, floor_number, room_number) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS manager (
    manager_code INT NOT NULL,
    PRIMARY KEY (manager_code),
    CONSTRAINT manager_code_foreignkey_constraint FOREIGN KEY (manager_code) REFERENCES personnel (unique_code) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS medication (
    med_code INT NOT NULL AUTO_INCREMENT,
    expiration_date DATE,
    name VARCHAR(50) COLLATE utf8mb4_general_ci NOT NULL,
    price INT NOT NULL,
    effects TEXT COLLATE utf8mb4_general_ci,
    PRIMARY KEY (med_code)
);

CREATE TABLE IF NOT EXISTS nurse (
    nurse_code INT NOT NULL,
    PRIMARY KEY (nurse_code),
    CONSTRAINT nurse_fk_constraint FOREIGN KEY (nurse_code) REFERENCES personnel (unique_code) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS testing (
    test_id INT NOT NULL AUTO_INCREMENT,
    date DATE NOT NULL,
    `time` TIME NOT NULL,
    patient_number INT NOT NULL,
    PRIMARY KEY (test_id),
    CONSTRAINT testing_fk_constraint FOREIGN KEY (patient_number) REFERENCES patient (patient_number) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS pcr_test (
    test_id INT NOT NULL,
    ct_value INT,
    result CHAR(1) COLLATE utf8mb4_general_ci NOT NULL,
    PRIMARY KEY (test_id),
    CONSTRAINT pcr_fk_constraint FOREIGN KEY (test_id) REFERENCES testing (test_id) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS quick_test (
    test_id INT NOT NULL,
    ct_value INT,
    result CHAR(1) COLLATE utf8mb4_general_ci NOT NULL,
    PRIMARY KEY (test_id),
    CONSTRAINT quick_fk_constraint FOREIGN KEY (test_id) REFERENCES testing (test_id) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS respiratory_test (
    test_id INT NOT NULL,
    breaths_per_minute INT NOT NULL,
    PRIMARY KEY (test_id),
    CONSTRAINT respiratory_fk_constraint FOREIGN KEY (test_id) REFERENCES testing (test_id) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS spo_test (
    test_id INT NOT NULL,
    blood_oxygen_level INT NOT NULL,
    PRIMARY KEY (test_id),
    CONSTRAINT spo_fk_constraint FOREIGN KEY (test_id) REFERENCES testing (test_id) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS symptom (
    patient_number INT NOT NULL,
    date_time TIMESTAMP NOT NULL,
    description TEXT COLLATE utf8mb4_general_ci,
    PRIMARY KEY (patient_number, date_time),
    CONSTRAINT symptom_fk_constraint FOREIGN KEY (patient_number) REFERENCES patient (patient_number) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS take_care_of (
    patient_number INT NOT NULL,
    nurse_code INT NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE,
    PRIMARY KEY (patient_number),
    CONSTRAINT takecareof_fk_constraint FOREIGN KEY (nurse_code) REFERENCES nurse (nurse_code) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS treatment (
    patient_number INT NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    result TEXT COLLATE utf8mb4_general_ci,
    PRIMARY KEY (patient_number, start_date, end_date),
    CONSTRAINT treatment_fk_constraint FOREIGN KEY (patient_number) REFERENCES patient (patient_number) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS treat (
    doctor_code INT NOT NULL,
    patient_number INT NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    PRIMARY KEY (doctor_code, patient_number, start_date, end_date),
    CONSTRAINT treat_fk_constraint FOREIGN KEY (doctor_code) REFERENCES doctor (doctor_code) ON UPDATE NO ACTION ON DELETE NO ACTION,
    CONSTRAINT treat_treatment_fk_constraint FOREIGN KEY (patient_number, start_date, end_date) REFERENCES treatment (patient_number, start_date, end_date) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS use (
    med_code INT NOT NULL,
    patient_number INT NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    PRIMARY KEY (med_code, patient_number, start_date, end_date),
    CONSTRAINT use_fk_constraint_1 FOREIGN KEY (med_code) REFERENCES medication (med_code) ON UPDATE NO ACTION ON DELETE NO ACTION,
    CONSTRAINT use_fk_constraint_2 FOREIGN KEY (patient_number, start_date, end_date) REFERENCES treatment (patient_number, start_date, end_date) ON UPDATE NO ACTION ON DELETE NO ACTION
);

CREATE TABLE IF NOT EXISTS volunteer (
    volunteer_code INT NOT NULL,
    PRIMARY KEY (volunteer_code),
    CONSTRAINT volunteer_fk_constraint FOREIGN KEY (volunteer_code) REFERENCES personnel (unique_code) ON UPDATE NO ACTION ON DELETE NO ACTION
);
